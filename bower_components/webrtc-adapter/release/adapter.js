(function(m){if("object"===typeof exports&&"undefined"!==typeof module)module.exports=m();else if("function"===typeof define&&define.amd)define([],m);else{var h;h="undefined"===typeof window?"undefined"===typeof global?"undefined"===typeof self?this:self:global:window,h.adapter=m()}})(function(){return function y(b,T,C){function S(E,P){if(!T[E]){if(!b[E]){var R="function"==typeof require&&require;if(!P&&R)return R(E,!0);if(k)return k(E,!0);var L=new Error("Cannot find module '"+E+"'");throw L.code="MODULE_NOT_FOUND",L}var D=T[E]={exports:{}};b[E][0].call(D.exports,function(M){var w=b[E][1][M];return S(w?w:M)},D,D.exports,y,b,T,C)}return T[E].exports}for(var k="function"==typeof require&&require,x=0;x<C.length;x++)S(C[x]);return S}({1:[function(y,b){"use strict";var C={};C.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},C.localCName=C.generateIdentifier(),C.splitLines=function(S){return S.trim().split("\n").map(function(k){return k.trim()})},C.splitSections=function(S){var k=S.split("\nm=");return k.map(function(x,E){return(0<E?"m="+x:x).trim()+"\r\n"})},C.matchPrefix=function(S,k){return C.splitLines(S).filter(function(x){return 0===x.indexOf(k)})},C.parseCandidate=function(S){var k=0===S.indexOf("a=candidate:")?S.substring(12).split(" "):S.substring(10).split(" ");for(var x={foundation:k[0],component:parseInt(k[1],10),protocol:k[2].toLowerCase(),priority:parseInt(k[3],10),ip:k[4],port:parseInt(k[5],10),type:k[7]},E=8;E<k.length;E+=2)switch(k[E]){case"raddr":x.relatedAddress=k[E+1];break;case"rport":x.relatedPort=parseInt(k[E+1],10);break;case"tcptype":x.tcpType=k[E+1];break;default:x[k[E]]=k[E+1];}return x},C.writeCandidate=function(S){var k=[S.foundation,S.component,S.protocol.toUpperCase(),S.priority,S.ip,S.port],x=S.type;return k.push("typ"),k.push(x),"host"!==x&&S.relatedAddress&&S.relatedPort&&(k.push("raddr"),k.push(S.relatedAddress),k.push("rport"),k.push(S.relatedPort)),S.tcpType&&"tcp"===S.protocol.toLowerCase()&&(k.push("tcptype"),k.push(S.tcpType)),"candidate:"+k.join(" ")},C.parseIceOptions=function(S){return S.substr(14).split(" ")},C.parseRtpMap=function(S){var k=S.substr(9).split(" "),x={payloadType:parseInt(k.shift(),10)};return k=k[0].split("/"),x.name=k[0],x.clockRate=parseInt(k[1],10),x.numChannels=3===k.length?parseInt(k[2],10):1,x},C.writeRtpMap=function(S){var k=S.payloadType;return void 0!==S.preferredPayloadType&&(k=S.preferredPayloadType),"a=rtpmap:"+k+" "+S.name+"/"+S.clockRate+(1===S.numChannels?"":"/"+S.numChannels)+"\r\n"},C.parseExtmap=function(S){var k=S.substr(9).split(" ");return{id:parseInt(k[0],10),direction:0<k[0].indexOf("/")?k[0].split("/")[1]:"sendrecv",uri:k[1]}},C.writeExtmap=function(S){return"a=extmap:"+(S.id||S.preferredId)+(S.direction&&"sendrecv"!==S.direction?"/"+S.direction:"")+" "+S.uri+"\r\n"},C.parseFmtp=function(S){for(var x,k={},E=S.substr(S.indexOf(" ")+1).split(";"),P=0;P<E.length;P++)x=E[P].trim().split("="),k[x[0].trim()]=x[1];return k},C.writeFmtp=function(S){var k="",x=S.payloadType;if(void 0!==S.preferredPayloadType&&(x=S.preferredPayloadType),S.parameters&&Object.keys(S.parameters).length){var E=[];Object.keys(S.parameters).forEach(function(P){E.push(P+"="+S.parameters[P])}),k+="a=fmtp:"+x+" "+E.join(";")+"\r\n"}return k},C.parseRtcpFb=function(S){var k=S.substr(S.indexOf(" ")+1).split(" ");return{type:k.shift(),parameter:k.join(" ")}},C.writeRtcpFb=function(S){var k="",x=S.payloadType;return void 0!==S.preferredPayloadType&&(x=S.preferredPayloadType),S.rtcpFeedback&&S.rtcpFeedback.length&&S.rtcpFeedback.forEach(function(E){k+="a=rtcp-fb:"+x+" "+E.type+(E.parameter&&E.parameter.length?" "+E.parameter:"")+"\r\n"}),k},C.parseSsrcMedia=function(S){var k=S.indexOf(" "),x={ssrc:parseInt(S.substr(7,k-7),10)},E=S.indexOf(":",k);return-1<E?(x.attribute=S.substr(k+1,E-k-1),x.value=S.substr(E+1)):x.attribute=S.substr(k+1),x},C.getMid=function(S){var k=C.matchPrefix(S,"a=mid:")[0];if(k)return k.substr(6)},C.parseFingerprint=function(S){var k=S.substr(14).split(" ");return{algorithm:k[0].toLowerCase(),value:k[1]}},C.getDtlsParameters=function(S,k){var x=C.matchPrefix(S+k,"a=fingerprint:");return{role:"auto",fingerprints:x.map(C.parseFingerprint)}},C.writeDtlsParameters=function(S,k){var x="a=setup:"+k+"\r\n";return S.fingerprints.forEach(function(E){x+="a=fingerprint:"+E.algorithm+" "+E.value+"\r\n"}),x},C.getIceParameters=function(S,k){var x=C.splitLines(S);x=x.concat(C.splitLines(k));var E={usernameFragment:x.filter(function(P){return 0===P.indexOf("a=ice-ufrag:")})[0].substr(12),password:x.filter(function(P){return 0===P.indexOf("a=ice-pwd:")})[0].substr(10)};return E},C.writeIceParameters=function(S){return"a=ice-ufrag:"+S.usernameFragment+"\r\na=ice-pwd:"+S.password+"\r\n"},C.parseRtpParameters=function(S){for(var k={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},x=C.splitLines(S),E=x[0].split(" "),P=3;P<E.length;P++){var R=E[P],L=C.matchPrefix(S,"a=rtpmap:"+R+" ")[0];if(L){var D=C.parseRtpMap(L),M=C.matchPrefix(S,"a=fmtp:"+R+" ");switch(D.parameters=M.length?C.parseFmtp(M[0]):{},D.rtcpFeedback=C.matchPrefix(S,"a=rtcp-fb:"+R+" ").map(C.parseRtcpFb),k.codecs.push(D),D.name.toUpperCase()){case"RED":case"ULPFEC":k.fecMechanisms.push(D.name.toUpperCase());break;default:}}}return C.matchPrefix(S,"a=extmap:").forEach(function(w){k.headerExtensions.push(C.parseExtmap(w))}),k},C.writeRtpDescription=function(S,k){var x="";x+="m="+S+" ",x+=0<k.codecs.length?"9":"0",x+=" UDP/TLS/RTP/SAVPF ",x+=k.codecs.map(function(P){return void 0===P.preferredPayloadType?P.payloadType:P.preferredPayloadType}).join(" ")+"\r\n",x+="c=IN IP4 0.0.0.0\r\n",x+="a=rtcp:9 IN IP4 0.0.0.0\r\n",k.codecs.forEach(function(P){x+=C.writeRtpMap(P),x+=C.writeFmtp(P),x+=C.writeRtcpFb(P)});var E=0;return k.codecs.forEach(function(P){P.maxptime>E&&(E=P.maxptime)}),0<E&&(x+="a=maxptime:"+E+"\r\n"),x+="a=rtcp-mux\r\n",k.headerExtensions.forEach(function(P){x+=C.writeExtmap(P)}),x},C.parseRtpEncodingParameters=function(S){var D,k=[],x=C.parseRtpParameters(S),E=-1!==x.fecMechanisms.indexOf("RED"),P=-1!==x.fecMechanisms.indexOf("ULPFEC"),R=C.matchPrefix(S,"a=ssrc:").map(function(_){return C.parseSsrcMedia(_)}).filter(function(_){return"cname"===_.attribute}),L=0<R.length&&R[0].ssrc,M=C.matchPrefix(S,"a=ssrc-group:FID").map(function(_){var I=_.split(" ");return I.shift(),I.map(function(O){return parseInt(O,10)})});0<M.length&&1<M[0].length&&M[0][0]===L&&(D=M[0][1]),x.codecs.forEach(function(_){if("RTX"===_.name.toUpperCase()&&_.parameters.apt){var I={ssrc:L,codecPayloadType:parseInt(_.parameters.apt,10),rtx:{ssrc:D}};k.push(I),E&&(I=JSON.parse(JSON.stringify(I)),I.fec={ssrc:D,mechanism:P?"red+ulpfec":"red"},k.push(I))}}),0===k.length&&L&&k.push({ssrc:L});var w=C.matchPrefix(S,"b=");return w.length&&(0===w[0].indexOf("b=TIAS:")?w=parseInt(w[0].substr(7),10):0===w[0].indexOf("b=AS:")&&(w=parseInt(w[0].substr(5),10)),k.forEach(function(_){_.maxBitrate=w})),k},C.parseRtcpParameters=function(S){var k={},E=C.matchPrefix(S,"a=ssrc:").map(function(L){return C.parseSsrcMedia(L)}).filter(function(L){return"cname"===L.attribute})[0];E&&(k.cname=E.value,k.ssrc=E.ssrc);var P=C.matchPrefix(S,"a=rtcp-rsize");k.reducedSize=0<P.length,k.compound=0===P.length;var R=C.matchPrefix(S,"a=rtcp-mux");return k.mux=0<R.length,k},C.parseMsid=function(S){var k,x=C.matchPrefix(S,"a=msid:");if(1===x.length)return k=x[0].substr(7).split(" "),{stream:k[0],track:k[1]};var E=C.matchPrefix(S,"a=ssrc:").map(function(P){return C.parseSsrcMedia(P)}).filter(function(P){return"msid"===P.attribute});if(0<E.length)return k=E[0].value.split(" "),{stream:k[0],track:k[1]}},C.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},C.writeMediaSection=function(S,k,x,E){var P=C.writeRtpDescription(S.kind,k);if(P+=C.writeIceParameters(S.iceGatherer.getLocalParameters()),P+=C.writeDtlsParameters(S.dtlsTransport.getLocalParameters(),"offer"===x?"actpass":"active"),P+="a=mid:"+S.mid+"\r\n",P+=S.direction?"a="+S.direction+"\r\n":S.rtpSender&&S.rtpReceiver?"a=sendrecv\r\n":S.rtpSender?"a=sendonly\r\n":S.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",S.rtpSender){var R="msid:"+E.id+" "+S.rtpSender.track.id+"\r\n";P+="a="+R,P+="a=ssrc:"+S.sendEncodingParameters[0].ssrc+" "+R,S.sendEncodingParameters[0].rtx&&(P+="a=ssrc:"+S.sendEncodingParameters[0].rtx.ssrc+" "+R,P+="a=ssrc-group:FID "+S.sendEncodingParameters[0].ssrc+" "+S.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return P+="a=ssrc:"+S.sendEncodingParameters[0].ssrc+" cname:"+C.localCName+"\r\n",S.rtpSender&&S.sendEncodingParameters[0].rtx&&(P+="a=ssrc:"+S.sendEncodingParameters[0].rtx.ssrc+" cname:"+C.localCName+"\r\n"),P},C.getDirection=function(S,k){for(var x=C.splitLines(S),E=0;E<x.length;E++)switch(x[E]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return x[E].substr(2);default:}return k?C.getDirection(k):"sendrecv"},C.getKind=function(S){var k=C.splitLines(S),x=k[0].split(" ");return x[0].substr(2)},C.isRejected=function(S){return"0"===S.split(" ",2)[1]},b.exports=C},{}],2:[function(y,b){"use strict";(function(){var C=y("./utils"),S=C.log,k=C.browserDetails;b.exports.browserDetails=k,b.exports.extractVersion=C.extractVersion,b.exports.disableLog=C.disableLog;var x=y("./chrome/chrome_shim")||null,E=y("./edge/edge_shim")||null,P=y("./firefox/firefox_shim")||null,R=y("./safari/safari_shim")||null;switch(k.browser){case"chrome":if(!x||!x.shimPeerConnection)return void S("Chrome shim is not included in this adapter release.");S("adapter.js shimming chrome."),b.exports.browserShim=x,x.shimGetUserMedia(),x.shimMediaStream(),C.shimCreateObjectURL(),x.shimSourceObject(),x.shimPeerConnection(),x.shimOnTrack(),x.shimGetSendersWithDtmf();break;case"firefox":if(!P||!P.shimPeerConnection)return void S("Firefox shim is not included in this adapter release.");S("adapter.js shimming firefox."),b.exports.browserShim=P,P.shimGetUserMedia(),C.shimCreateObjectURL(),P.shimSourceObject(),P.shimPeerConnection(),P.shimOnTrack();break;case"edge":if(!E||!E.shimPeerConnection)return void S("MS edge shim is not included in this adapter release.");S("adapter.js shimming edge."),b.exports.browserShim=E,E.shimGetUserMedia(),C.shimCreateObjectURL(),E.shimPeerConnection(),E.shimReplaceTrack();break;case"safari":if(!R)return void S("Safari shim is not included in this adapter release.");S("adapter.js shimming safari."),b.exports.browserShim=R,R.shimCallbacksAPI(),R.shimAddStream(),R.shimOnAddStream(),R.shimGetUserMedia();break;default:S("Unsupported browser!");}})()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":8,"./safari/safari_shim":10,"./utils":11}],3:[function(y,b){"use strict";var C=y("../utils.js").log,S=y("../utils.js").browserDetails,k={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"===typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)&&Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(x){var E=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=x),this.addEventListener("addstream",this._ontrackpoly=function(P){P.stream.addEventListener("addtrack",function(R){var L=RTCPeerConnection.prototype.getReceivers?E.getReceivers().find(function(M){return M.track.id===R.track.id}):{track:R.track};var D=new Event("track");D.track=R.track,D.receiver=L,D.streams=[P.stream],E.dispatchEvent(D)}),P.stream.getTracks().forEach(function(R){var L=RTCPeerConnection.prototype.getReceivers?E.getReceivers().find(function(M){return M.track.id===R.id}):{track:R};var D=new Event("track");D.track=R,D.receiver=L,D.streams=[P.stream],this.dispatchEvent(D)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"===typeof window&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var x=RTCPeerConnection.prototype.addStream,E=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addTrack||(RTCPeerConnection.prototype.addTrack=function(P,R){var L=this;if("closed"===L.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var D=[].slice.call(arguments,1);if(1!==D.length||!D[0].getTracks().find(function(O){return O===P}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");L._senders=L._senders||[];var M=L._senders.find(function(O){return O.track===P});if(M)throw new DOMException("Track already exists.","InvalidAccessError");L._streams=L._streams||{};var w=L._streams[R.id];if(w)w.addTrack(P),L.removeStream(w),L.addStream(w);else{var _=new MediaStream([P]);L._streams[R.id]=_,L.addStream(_)}var I={track:P,get dtmf(){return void 0===this._dtmf&&("audio"===P.kind?this._dtmf=L.createDTMFSender(P):this._dtmf=null),this._dtmf}};return L._senders.push(I),I}),RTCPeerConnection.prototype.addStream=function(P){var R=this;R._senders=R._senders||[],x.apply(R,[P]),P.getTracks().forEach(function(L){R._senders.push({track:L,get dtmf(){return void 0===this._dtmf&&("audio"===L.kind?this._dtmf=R.createDTMFSender(L):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(P){var R=this;R._senders=R._senders||[],E.apply(R,[P]),P.getTracks().forEach(function(L){var D=R._senders.find(function(M){return M.track===L});D&&R._senders.splice(R._senders.indexOf(D),1)})}}},shimSourceObject:function(){"object"===typeof window&&window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)&&Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(x){var E=this;return this._srcObject=x,this.src&&URL.revokeObjectURL(this.src),x?void(this.src=URL.createObjectURL(x),x.addEventListener("addtrack",function(){E.src&&URL.revokeObjectURL(E.src),E.src=URL.createObjectURL(x)}),x.addEventListener("removetrack",function(){E.src&&URL.revokeObjectURL(E.src),E.src=URL.createObjectURL(x)})):(this.src="",void 0)}})},shimPeerConnection:function(){if(!window.RTCPeerConnection)window.RTCPeerConnection=function(R,L){return C("PeerConnection"),R&&R.iceTransportPolicy&&(R.iceTransports=R.iceTransportPolicy),new webkitRTCPeerConnection(R,L)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});else{var x=RTCPeerConnection;window.RTCPeerConnection=function(R,L){if(R&&R.iceServers){for(var w,D=[],M=0;M<R.iceServers.length;M++)w=R.iceServers[M],!w.hasOwnProperty("urls")&&w.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),w=JSON.parse(JSON.stringify(w)),w.urls=w.url,D.push(w)):D.push(R.iceServers[M]);R.iceServers=D}return new x(R,L)},window.RTCPeerConnection.prototype=x.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return x.generateCertificate}})}var E=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(R,L,D){var M=this,w=arguments;if(0<arguments.length&&"function"===typeof R)return E.apply(this,arguments);if(0===E.length&&(0===arguments.length||"function"!==typeof arguments[0]))return E.apply(this,[]);var _=function(U){var G={},A=U.result();return A.forEach(function(N){var F={id:N.id,timestamp:N.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[N.type]||N.type};N.names().forEach(function(B){F[B]=N.stat(B)}),G[F.id]=F}),G},I=function(U){return new Map(Object.keys(U).map(function(G){return[G,U[G]]}))};if(2<=arguments.length){var O=function(U){w[1](I(_(U)))};return E.apply(this,[O,arguments[0]])}return new Promise(function(U,G){E.apply(M,[function(A){U(I(_(A)))},G])}).then(L,D)},51>S.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(R){var L=RTCPeerConnection.prototype[R];RTCPeerConnection.prototype[R]=function(){var D=arguments,M=this,w=new Promise(function(_,I){L.apply(M,[D[0],_,I])});return 2>D.length?w:w.then(function(){D[1].apply(null,[])},function(_){3<=D.length&&D[2].apply(null,[_])})}}),52>S.version&&["createOffer","createAnswer"].forEach(function(R){var L=RTCPeerConnection.prototype[R];RTCPeerConnection.prototype[R]=function(){var D=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var M=1===arguments.length?arguments[0]:void 0;return new Promise(function(w,_){L.apply(D,[w,_,M])})}return L.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(R){var L=RTCPeerConnection.prototype[R];RTCPeerConnection.prototype[R]=function(){return arguments[0]=new("addIceCandidate"===R?RTCIceCandidate:RTCSessionDescription)(arguments[0]),L.apply(this,arguments)}});var P=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?P.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};b.exports={shimMediaStream:k.shimMediaStream,shimOnTrack:k.shimOnTrack,shimGetSendersWithDtmf:k.shimGetSendersWithDtmf,shimSourceObject:k.shimSourceObject,shimPeerConnection:k.shimPeerConnection,shimGetUserMedia:y("./getusermedia")}},{"../utils.js":11,"./getusermedia":4}],4:[function(y,b){"use strict";var C=y("../utils.js").log,S=y("../utils.js").browserDetails;b.exports=function(){var k=function(D){if("object"!==typeof D||D.mandatory||D.optional)return D;var M={};return Object.keys(D).forEach(function(w){if("require"!==w&&"advanced"!==w&&"mediaSource"!==w){var _="object"===typeof D[w]?D[w]:{ideal:D[w]};void 0!==_.exact&&"number"===typeof _.exact&&(_.min=_.max=_.exact);var I=function(U,G){return U?U+G.charAt(0).toUpperCase()+G.slice(1):"deviceId"===G?"sourceId":G};if(void 0!==_.ideal){M.optional=M.optional||[];var O={};"number"===typeof _.ideal?(O[I("min",w)]=_.ideal,M.optional.push(O),O={},O[I("max",w)]=_.ideal,M.optional.push(O)):(O[I("",w)]=_.ideal,M.optional.push(O))}void 0!==_.exact&&"number"!==typeof _.exact?(M.mandatory=M.mandatory||{},M.mandatory[I("",w)]=_.exact):["min","max"].forEach(function(U){void 0!==_[U]&&(M.mandatory=M.mandatory||{},M.mandatory[I(U,w)]=_[U])})}}),D.advanced&&(M.optional=(M.optional||[]).concat(D.advanced)),M},x=function(D,M){if(D=JSON.parse(JSON.stringify(D)),D&&D.audio&&(D.audio=k(D.audio)),D&&"object"===typeof D.video){var w=D.video.facingMode;w=w&&("object"===typeof w?w:{ideal:w});var _=61>S.version;if(w&&("user"===w.exact||"environment"===w.exact||"user"===w.ideal||"environment"===w.ideal)&&!(navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().facingMode&&!_)){delete D.video.facingMode;var I;if("environment"===w.exact||"environment"===w.ideal?I=["back","rear"]:("user"===w.exact||"user"===w.ideal)&&(I=["front"]),I)return navigator.mediaDevices.enumerateDevices().then(function(O){O=O.filter(function(G){return"videoinput"===G.kind});var U=O.find(function(G){return I.some(function(A){return-1!==G.label.toLowerCase().indexOf(A)})});return!U&&O.length&&-1!==I.indexOf("back")&&(U=O[O.length-1]),U&&(D.video.deviceId=w.exact?{exact:U.deviceId}:{ideal:U.deviceId}),D.video=k(D.video),C("chrome: "+JSON.stringify(D)),M(D)})}D.video=k(D.video)}return C("chrome: "+JSON.stringify(D)),M(D)},E=function(D){return{name:{ConstraintNotSatisfiedError:"OverconstrainedError",PermissionDeniedError:"NotAllowedError",TrackStartError:"NotReadableError"}[D.name]||D.name,message:D.message,constraint:D.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(D,M,w){x(D,function(_){navigator.webkitGetUserMedia(_,M,function(I){w(E(I))})})};var R=function(D){return new Promise(function(M,w){navigator.getUserMedia(D,M,w)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:R,enumerateDevices:function(){return new Promise(function(D){var M={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(w){D(w.map(function(_){return{label:_.label,kind:M[_.kind],deviceId:_.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),!navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia=function(D){return R(D)};else{var L=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(D){return x(D,function(M){return L(M).then(function(w){if(M.audio&&!w.getAudioTracks().length||M.video&&!w.getVideoTracks().length)throw w.getTracks().forEach(function(_){_.stop()}),new DOMException("","NotFoundError");return w},function(w){return Promise.reject(E(w))})})}}"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){C("Dummy mediaDevices.addEventListener called.")}),"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){C("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":11}],5:[function(y,b){"use strict";var C=y("../utils").browserDetails,S=y("./rtcpeerconnection_shim");b.exports={shimGetUserMedia:y("./getusermedia"),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(x){return x}),window.RTCSessionDescription||(window.RTCSessionDescription=function(x){return x}),15025>C.version)){var k=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(x){k.set.call(this,x);var E=new Event("enabled");E.enabled=x,this.dispatchEvent(E)}})}window.RTCPeerConnection=S(C.version)},shimReplaceTrack:function(){window.RTCRtpSender&&!("replaceTrack"in RTCRtpSender.prototype)&&(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},{"../utils":11,"./getusermedia":6,"./rtcpeerconnection_shim":7}],6:[function(y,b){"use strict";b.exports=function(){var C=function(k){return{name:{PermissionDeniedError:"NotAllowedError"}[k.name]||k.name,message:k.message,constraint:k.constraint,toString:function(){return this.name}}},S=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(k){return S(k).catch(function(x){return Promise.reject(C(x))})}}},{}],7:[function(y,b){"use strict";function C(P){var R=P.filter(function(D){return"audio"===D.kind}),L=P.filter(function(D){return"video"===D.kind});for(P=[];R.length||L.length;)R.length&&P.push(R.shift()),L.length&&P.push(L.shift());return P}function S(P,R){var L=!1;return P=JSON.parse(JSON.stringify(P)),P.filter(function(D){if(D&&(D.urls||D.url)){var M=D.urls||D.url;D.url&&!D.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var w="string"===typeof M;return w&&(M=[M]),M=M.filter(function(_){var I=0===_.indexOf("turn:")&&-1!==_.indexOf("transport=udp")&&-1===_.indexOf("turn:[")&&!L;return I?(L=!0,!0):0===_.indexOf("stun:")&&14393<=R}),delete D.url,D.urls=w?M[0]:M,!!M.length}return!1})}function k(P,R){var L={codecs:[],headerExtensions:[],fecMechanisms:[]},D=function(w,_){w=parseInt(w,10);for(var I=0;I<_.length;I++)if(_[I].payloadType===w||_[I].preferredPayloadType===w)return _[I]},M=function(w,_,I,O){var U=D(w.parameters.apt,I),G=D(_.parameters.apt,O);return U&&G&&U.name.toLowerCase()===G.name.toLowerCase()};return P.codecs.forEach(function(w){for(var I,_=0;_<R.codecs.length;_++)if(I=R.codecs[_],w.name.toLowerCase()===I.name.toLowerCase()&&w.clockRate===I.clockRate){if("rtx"===w.name.toLowerCase()&&w.parameters&&I.parameters.apt&&!M(w,I,P.codecs,R.codecs))continue;I=JSON.parse(JSON.stringify(I)),I.numChannels=Math.min(w.numChannels,I.numChannels),L.codecs.push(I),I.rtcpFeedback=I.rtcpFeedback.filter(function(O){for(var U=0;U<w.rtcpFeedback.length;U++)if(w.rtcpFeedback[U].type===O.type&&w.rtcpFeedback[U].parameter===O.parameter)return!0;return!1});break}}),P.headerExtensions.forEach(function(w){for(var I,_=0;_<R.headerExtensions.length;_++)if(I=R.headerExtensions[_],w.uri===I.uri){L.headerExtensions.push(I);break}}),L}function x(P,R,L){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[R][P].indexOf(L)}var E=y("sdp");b.exports=function(P){var R=function(L){var D=this,M=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(w){D[w]=M[w].bind(M)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return D.localStreams},this.getRemoteStreams=function(){return D.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},L&&L.iceTransportPolicy)switch(L.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=L.iceTransportPolicy;break;default:}this.usingBundle=L&&"max-bundle"===L.bundlePolicy,L&&L.iceServers&&(this.iceOptions.iceServers=S(L.iceServers,P)),this._config=L||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return R.prototype._emitGatheringStateChange=function(){var L=new Event("icegatheringstatechange");this.dispatchEvent(L),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(L)},R.prototype._emitBufferedCandidates=function(){var L=this,D=E.splitSections(L.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(M){var w=!M.candidate||0===Object.keys(M.candidate).length;if(w)for(var _=1;_<D.length;_++)-1===D[_].indexOf("\r\na=end-of-candidates\r\n")&&(D[_]+="a=end-of-candidates\r\n");else D[M.candidate.sdpMLineIndex+1]+="a="+M.candidate.candidate+"\r\n";if(L.localDescription.sdp=D.join(""),L.dispatchEvent(M),null!==L.onicecandidate&&L.onicecandidate(M),!M.candidate&&"complete"!==L.iceGatheringState){var I=L.transceivers.every(function(O){return O.iceGatherer&&"completed"===O.iceGatherer.state});I&&"complete"!==L.iceGatheringStateChange&&(L.iceGatheringState="complete",L._emitGatheringStateChange())}}),this._localIceCandidatesBuffer=[]},R.prototype.getConfiguration=function(){return this._config},R.prototype._createTransceiver=function(L){var D=0<this.transceivers.length,M={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:L,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&D)M.iceTransport=this.transceivers[0].iceTransport,M.dtlsTransport=this.transceivers[0].dtlsTransport;else{var w=this._createIceAndDtlsTransports();M.iceTransport=w.iceTransport,M.dtlsTransport=w.dtlsTransport}return this.transceivers.push(M),M},R.prototype.addTrack=function(L,D){for(var M,w=0;w<this.transceivers.length;w++)this.transceivers[w].track||this.transceivers[w].kind!==L.kind||(M=this.transceivers[w]);return M||(M=this._createTransceiver(L.kind)),M.track=L,M.stream=D,M.rtpSender=new RTCRtpSender(L,M.dtlsTransport),this._maybeFireNegotiationNeeded(),M.rtpSender},R.prototype.addStream=function(L){var D=this;if(15025<=P)this.localStreams.push(L),L.getTracks().forEach(function(w){D.addTrack(w,L)});else{var M=L.clone();L.getTracks().forEach(function(w,_){var I=M.getTracks()[_];w.addEventListener("enabled",function(O){I.enabled=O.enabled})}),M.getTracks().forEach(function(w){D.addTrack(w,M)}),this.localStreams.push(M)}this._maybeFireNegotiationNeeded()},R.prototype.removeStream=function(L){var D=this.localStreams.indexOf(L);-1<D&&(this.localStreams.splice(D,1),this._maybeFireNegotiationNeeded())},R.prototype.getSenders=function(){return this.transceivers.filter(function(L){return!!L.rtpSender}).map(function(L){return L.rtpSender})},R.prototype.getReceivers=function(){return this.transceivers.filter(function(L){return!!L.rtpReceiver}).map(function(L){return L.rtpReceiver})},R.prototype._createIceGatherer=function(L,D){var M=this,w=new RTCIceGatherer(M.iceOptions);return w.onlocalcandidate=function(_){var I=new Event("icecandidate");I.candidate={sdpMid:L,sdpMLineIndex:D};var O=_.candidate,U=!O||0===Object.keys(O).length;U?void 0===w.state&&(w.state="completed"):(O.component=1,I.candidate.candidate=E.writeCandidate(O));var G=E.splitSections(M.localDescription.sdp);G[I.candidate.sdpMLineIndex+1]+=U?"a=end-of-candidates\r\n":"a="+I.candidate.candidate+"\r\n",M.localDescription.sdp=G.join("");var A=M._pendingOffer?M._pendingOffer:M.transceivers,N=A.every(function(F){return F.iceGatherer&&"completed"===F.iceGatherer.state});switch(M.iceGatheringState){case"new":U||M._localIceCandidatesBuffer.push(I),U&&N&&M._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":M._emitBufferedCandidates(),U||(M.dispatchEvent(I),null!==M.onicecandidate&&M.onicecandidate(I)),N&&(M.dispatchEvent(new Event("icecandidate")),null!==M.onicecandidate&&M.onicecandidate(new Event("icecandidate")),M.iceGatheringState="complete",M._emitGatheringStateChange());break;case"complete":break;default:}},w},R.prototype._createIceAndDtlsTransports=function(){var L=this,D=new RTCIceTransport(null);D.onicestatechange=function(){L._updateConnectionState()};var M=new RTCDtlsTransport(D);return M.ondtlsstatechange=function(){L._updateConnectionState()},M.onerror=function(){Object.defineProperty(M,"state",{value:"failed",writable:!0}),L._updateConnectionState()},{iceTransport:D,dtlsTransport:M}},R.prototype._disposeIceAndDtlsTransports=function(L){var D=this.transceivers[L].iceGatherer;D&&(delete D.onlocalcandidate,delete this.transceivers[L].iceGatherer);var M=this.transceivers[L].iceTransport;M&&(delete M.onicestatechange,delete this.transceivers[L].iceTransport);var w=this.transceivers[L].dtlsTransport;w&&(delete w.ondtlssttatechange,delete w.onerror,delete this.transceivers[L].dtlsTransport)},R.prototype._transceive=function(L,D,M){var w=k(L.localCapabilities,L.remoteCapabilities);D&&L.rtpSender&&(w.encodings=L.sendEncodingParameters,w.rtcp={cname:E.localCName,compound:L.rtcpParameters.compound},L.recvEncodingParameters.length&&(w.rtcp.ssrc=L.recvEncodingParameters[0].ssrc),L.rtpSender.send(w)),M&&L.rtpReceiver&&("video"===L.kind&&L.recvEncodingParameters&&15019>P&&L.recvEncodingParameters.forEach(function(_){delete _.rtx}),w.encodings=L.recvEncodingParameters,w.rtcp={cname:L.rtcpParameters.cname,compound:L.rtcpParameters.compound},L.sendEncodingParameters.length&&(w.rtcp.ssrc=L.sendEncodingParameters[0].ssrc),L.rtpReceiver.receive(w))},R.prototype.setLocalDescription=function(L){var D=this;if(!x("setLocalDescription",L.type,this.signalingState)){var M=new Error("Can not set local "+L.type+" in state "+this.signalingState);return M.name="InvalidStateError",2<arguments.length&&"function"===typeof arguments[2]&&window.setTimeout(arguments[2],0,M),Promise.reject(M)}var w,_;if("offer"===L.type)this._pendingOffer&&(w=E.splitSections(L.sdp),_=w.shift(),w.forEach(function(A,N){var F=E.parseRtpParameters(A);D._pendingOffer[N].localCapabilities=F}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===L.type){w=E.splitSections(D.remoteDescription.sdp),_=w.shift();var I=0<E.matchPrefix(_,"a=ice-lite").length;w.forEach(function(A,N){var F=D.transceivers[N],B=F.iceGatherer,V=F.iceTransport,H=F.dtlsTransport,z=F.localCapabilities,q=F.remoteCapabilities,W=E.isRejected(A);if(!W&&!F.isDatachannel){var K=E.getIceParameters(A,_),X=E.getDtlsParameters(A,_);I&&(X.role="server"),D.usingBundle&&0!==N||(V.start(B,K,I?"controlling":"controlled"),H.start(X));var Q=k(z,q);D._transceive(F,0<Q.codecs.length,!1)}})}switch(this.localDescription={type:L.type,sdp:L.sdp},L.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError("unsupported type \""+L.type+"\"");}var O=1<arguments.length&&"function"===typeof arguments[1];if(O){var U=arguments[1];window.setTimeout(function(){U(),"new"===D.iceGatheringState&&(D.iceGatheringState="gathering",D._emitGatheringStateChange()),D._emitBufferedCandidates()},0)}var G=Promise.resolve();return G.then(function(){O||("new"===D.iceGatheringState&&(D.iceGatheringState="gathering",D._emitGatheringStateChange()),window.setTimeout(D._emitBufferedCandidates.bind(D),500))}),G},R.prototype.setRemoteDescription=function(L){var D=this;if(!x("setRemoteDescription",L.type,this.signalingState)){var M=new Error("Can not set remote "+L.type+" in state "+this.signalingState);return M.name="InvalidStateError",2<arguments.length&&"function"===typeof arguments[2]&&window.setTimeout(arguments[2],0,M),Promise.reject(M)}var w={},_=[],I=E.splitSections(L.sdp),O=I.shift(),U=0<E.matchPrefix(O,"a=ice-lite").length,G=0<E.matchPrefix(O,"a=group:BUNDLE ").length;this.usingBundle=G;var A=E.matchPrefix(O,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!A&&0<=A.substr(14).split(" ").indexOf("trickle"),I.forEach(function(N,F){var B=E.splitLines(N),V=E.getKind(N),H=E.isRejected(N),z=B[0].substr(2).split(" ")[2],q=E.getDirection(N,O),W=E.parseMsid(N),K=E.getMid(N)||E.generateIdentifier();if("application"===V&&"DTLS/SCTP"===z)return void(D.transceivers[F]={mid:K,isDatachannel:!0});var X,Q,J,Y,Z,$,ee,re,ae,ne,se,ie=E.parseRtpParameters(N);H||(ne=E.getIceParameters(N,O),se=E.getDtlsParameters(N,O),se.role="client"),ee=E.parseRtpEncodingParameters(N);var oe=E.parseRtcpParameters(N),de=0<E.matchPrefix(N,"a=end-of-candidates",O).length,ce=E.matchPrefix(N,"a=candidate:").map(function(pe){return E.parseCandidate(pe)}).filter(function(pe){return"1"===pe.component||1===pe.component});"offer"!==L.type||H?"answer"===L.type&&!H&&(G&&0<F&&(D._disposeIceAndDtlsTransports(F),D.transceivers[F].iceGatherer=D.transceivers[0].iceGatherer,D.transceivers[F].iceTransport=D.transceivers[0].iceTransport,D.transceivers[F].dtlsTransport=D.transceivers[0].dtlsTransport,D.transceivers[F].rtpSender&&D.transceivers[F].rtpSender.setTransport(D.transceivers[0].dtlsTransport),D.transceivers[F].rtpReceiver&&D.transceivers[F].rtpReceiver.setTransport(D.transceivers[0].dtlsTransport)),X=D.transceivers[F],Q=X.iceGatherer,J=X.iceTransport,Y=X.dtlsTransport,Z=X.rtpReceiver,$=X.sendEncodingParameters,re=X.localCapabilities,D.transceivers[F].recvEncodingParameters=ee,D.transceivers[F].remoteCapabilities=ie,D.transceivers[F].rtcpParameters=oe,(U||de)&&ce.length&&J.setRemoteCandidates(ce),(!G||0===F)&&(J.start(Q,ne,"controlling"),Y.start(se)),D._transceive(X,"sendrecv"===q||"recvonly"===q,"sendrecv"===q||"sendonly"===q),Z&&("sendrecv"===q||"sendonly"===q)?(ae=Z.track,W?(!w[W.stream]&&(w[W.stream]=new MediaStream),w[W.stream].addTrack(ae),_.push([ae,Z,w[W.stream]])):(!w.default&&(w.default=new MediaStream),w.default.addTrack(ae),_.push([ae,Z,w.default]))):delete X.rtpReceiver):(X=D.transceivers[F]||D._createTransceiver(V),X.mid=K,!X.iceGatherer&&(X.iceGatherer=G&&0<F?D.transceivers[0].iceGatherer:D._createIceGatherer(K,F)),de&&(!G||0===F)&&X.iceTransport.setRemoteCandidates(ce),re=RTCRtpReceiver.getCapabilities(V),15019>P&&(re.codecs=re.codecs.filter(function(pe){return"rtx"!==pe.name})),$=[{ssrc:1001*(2*F+2)}],("sendrecv"===q||"sendonly"===q)&&(Z=new RTCRtpReceiver(X.dtlsTransport,V),ae=Z.track,W?(!w[W.stream]&&(w[W.stream]=new MediaStream,Object.defineProperty(w[W.stream],"id",{get:function(){return W.stream}})),Object.defineProperty(ae,"id",{get:function(){return W.track}}),w[W.stream].addTrack(ae),_.push([ae,Z,w[W.stream]])):(!w.default&&(w.default=new MediaStream),w.default.addTrack(ae),_.push([ae,Z,w.default]))),X.localCapabilities=re,X.remoteCapabilities=ie,X.rtpReceiver=Z,X.rtcpParameters=oe,X.sendEncodingParameters=$,X.recvEncodingParameters=ee,D._transceive(D.transceivers[F],!1,"sendrecv"===q||"sendonly"===q))}),this.remoteDescription={type:L.type,sdp:L.sdp},L.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError("unsupported type \""+L.type+"\"");}return Object.keys(w).forEach(function(N){var F=w[N];if(F.getTracks().length){D.remoteStreams.push(F);var B=new Event("addstream");B.stream=F,D.dispatchEvent(B),null!==D.onaddstream&&window.setTimeout(function(){D.onaddstream(B)},0),_.forEach(function(V){var H=V[0],z=V[1];if(F.id===V[2].id){var q=new Event("track");q.track=H,q.receiver=z,q.streams=[F],D.dispatchEvent(q),null!==D.ontrack&&window.setTimeout(function(){D.ontrack(q)},0)}})}}),window.setTimeout(function(){D&&D.transceivers&&D.transceivers.forEach(function(N){N.iceTransport&&"new"===N.iceTransport.state&&0<N.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),N.iceTransport.addRemoteCandidate({}))})},4e3),1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},R.prototype.close=function(){this.transceivers.forEach(function(L){L.iceTransport&&L.iceTransport.stop(),L.dtlsTransport&&L.dtlsTransport.stop(),L.rtpSender&&L.rtpSender.stop(),L.rtpReceiver&&L.rtpReceiver.stop()}),this._updateSignalingState("closed")},R.prototype._updateSignalingState=function(L){this.signalingState=L;var D=new Event("signalingstatechange");this.dispatchEvent(D),null!==this.onsignalingstatechange&&this.onsignalingstatechange(D)},R.prototype._maybeFireNegotiationNeeded=function(){var L=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,window.setTimeout(function(){if(!1!==L.needNegotiation){L.needNegotiation=!1;var D=new Event("negotiationneeded");L.dispatchEvent(D),null!==L.onnegotiationneeded&&L.onnegotiationneeded(D)}},0))},R.prototype._updateConnectionState=function(){var D,L=this,M={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(_){M[_.iceTransport.state]++,M[_.dtlsTransport.state]++}),M.connected+=M.completed,D="new",0<M.failed?D="failed":0<M.connecting||0<M.checking?D="connecting":0<M.disconnected?D="disconnected":0<M.new?D="new":(0<M.connected||0<M.completed)&&(D="connected"),D!==L.iceConnectionState){L.iceConnectionState=D;var w=new Event("iceconnectionstatechange");this.dispatchEvent(w),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(w)}},R.prototype.createOffer=function(){var L=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var D;1===arguments.length&&"function"!==typeof arguments[0]?D=arguments[0]:3===arguments.length&&(D=arguments[2]);var M=this.transceivers.filter(function(U){return"audio"===U.kind}).length,w=this.transceivers.filter(function(U){return"video"===U.kind}).length;if(D){if(D.mandatory||D.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==D.offerToReceiveAudio&&(!0===D.offerToReceiveAudio?M=1:!1===D.offerToReceiveAudio?M=0:M=D.offerToReceiveAudio),void 0!==D.offerToReceiveVideo&&(!0===D.offerToReceiveVideo?w=1:!1===D.offerToReceiveVideo?w=0:w=D.offerToReceiveVideo)}for(this.transceivers.forEach(function(U){"audio"===U.kind?(M--,0>M&&(U.wantReceive=!1)):"video"===U.kind&&(w--,0>w&&(U.wantReceive=!1))});0<M||0<w;)0<M&&(this._createTransceiver("audio"),M--),0<w&&(this._createTransceiver("video"),w--);var _=C(this.transceivers),I=E.writeSessionBoilerplate();_.forEach(function(U,G){var A=U.track,N=U.kind,F=E.generateIdentifier();U.mid=F,U.iceGatherer||(U.iceGatherer=L.usingBundle&&0<G?_[0].iceGatherer:L._createIceGatherer(F,G));var B=RTCRtpSender.getCapabilities(N);15019>P&&(B.codecs=B.codecs.filter(function(H){return"rtx"!==H.name})),B.codecs.forEach(function(H){"H264"===H.name&&void 0===H.parameters["level-asymmetry-allowed"]&&(H.parameters["level-asymmetry-allowed"]="1")});var V=[{ssrc:1001*(2*G+1)}];A&&15019<=P&&"video"===N&&(V[0].rtx={ssrc:1001*(2*G+1)+1}),U.wantReceive&&(U.rtpReceiver=new RTCRtpReceiver(U.dtlsTransport,N)),U.localCapabilities=B,U.sendEncodingParameters=V}),"max-compat"!==this._config.bundlePolicy&&(I+="a=group:BUNDLE "+_.map(function(U){return U.mid}).join(" ")+"\r\n"),I+="a=ice-options:trickle\r\n",_.forEach(function(U){I+=E.writeMediaSection(U,U.localCapabilities,"offer",U.stream),I+="a=rtcp-rsize\r\n"}),this._pendingOffer=_;var O=new RTCSessionDescription({type:"offer",sdp:I});return arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,O),Promise.resolve(O)},R.prototype.createAnswer=function(){var L=E.writeSessionBoilerplate();this.usingBundle&&(L+="a=group:BUNDLE "+this.transceivers.map(function(M){return M.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(M,w){if(M.isDatachannel)return void(L+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+M.mid+"\r\n");if(M.stream){var _;"audio"===M.kind?_=M.stream.getAudioTracks()[0]:"video"===M.kind&&(_=M.stream.getVideoTracks()[0]),_&&15019<=P&&"video"===M.kind&&(M.sendEncodingParameters[0].rtx={ssrc:1001*(2*w+2)+1})}var I=k(M.localCapabilities,M.remoteCapabilities),O=I.codecs.filter(function(U){return"rtx"===U.name.toLowerCase()}).length;!O&&M.sendEncodingParameters[0].rtx&&delete M.sendEncodingParameters[0].rtx,L+=E.writeMediaSection(M,I,"answer",M.stream),M.rtcpParameters&&M.rtcpParameters.reducedSize&&(L+="a=rtcp-rsize\r\n")});var D=new RTCSessionDescription({type:"answer",sdp:L});return arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,D),Promise.resolve(D)},R.prototype.addIceCandidate=function(L){if(!L){for(var D=0;D<this.transceivers.length;D++)if(this.transceivers[D].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();}else{var M=L.sdpMLineIndex;if(L.sdpMid)for(var w=0;w<this.transceivers.length;w++)if(this.transceivers[w].mid===L.sdpMid){M=w;break}var _=this.transceivers[M];if(_){var I=0<Object.keys(L.candidate).length?E.parseCandidate(L.candidate):{};if("tcp"===I.protocol&&(0===I.port||9===I.port))return Promise.resolve();if(I.component&&"1"!==I.component&&1!==I.component)return Promise.resolve();_.iceTransport.addRemoteCandidate(I);var O=E.splitSections(this.remoteDescription.sdp);O[M+1]+=(I.type?L.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=O.join("")}}return 1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},R.prototype.getStats=function(){var L=[];this.transceivers.forEach(function(w){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(_){w[_]&&L.push(w[_].getStats())})});var D=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1],M=function(w){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[w.type]||w.type};return new Promise(function(w){var _=new Map;Promise.all(L).then(function(I){I.forEach(function(O){Object.keys(O).forEach(function(U){O[U].type=M(O[U]),_.set(U,O[U])})}),D&&window.setTimeout(D,0,_),w(_)})})},R}},{sdp:1}],8:[function(y,b){"use strict";var C=y("../utils").browserDetails,S={shimOnTrack:function(){"object"===typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)&&Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(k){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=k),this.addEventListener("addstream",this._ontrackpoly=function(x){x.stream.getTracks().forEach(function(E){var P=new Event("track");P.track=E,P.receiver={track:E},P.streams=[x.stream],this.dispatchEvent(P)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===typeof window&&window.HTMLMediaElement&&!("srcObject"in window.HTMLMediaElement.prototype)&&Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(k){this.mozSrcObject=k}})},shimPeerConnection:function(){if("object"===typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(R,L){if(38>C.version&&R&&R.iceServers){for(var w,D=[],M=0;M<R.iceServers.length;M++)if(w=R.iceServers[M],w.hasOwnProperty("urls"))for(var I,_=0;_<w.urls.length;_++)I={url:w.urls[_]},0===w.urls[_].indexOf("turn")&&(I.username=w.username,I.credential=w.credential),D.push(I);else D.push(R.iceServers[M]);R.iceServers=D}return new mozRTCPeerConnection(R,L)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(R){var L=RTCPeerConnection.prototype[R];RTCPeerConnection.prototype[R]=function(){return arguments[0]=new("addIceCandidate"===R?RTCIceCandidate:RTCSessionDescription)(arguments[0]),L.apply(this,arguments)}});var k=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?k.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var x=function(R){var L=new Map;return Object.keys(R).forEach(function(D){L.set(D,R[D]),L[D]=R[D]}),L},E={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},P=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(R,L,D){return P.apply(this,[R||null]).then(function(M){if(48>C.version&&(M=x(M)),53>C.version&&!L)try{M.forEach(function(w){w.type=E[w.type]||w.type})}catch(w){if("TypeError"!==w.name)throw w;M.forEach(function(_,I){M.set(I,Object.assign({},_,{type:E[_.type]||_.type}))})}return M}).then(L,D)}}}};b.exports={shimOnTrack:S.shimOnTrack,shimSourceObject:S.shimSourceObject,shimPeerConnection:S.shimPeerConnection,shimGetUserMedia:y("./getusermedia")}},{"../utils":11,"./getusermedia":9}],9:[function(y,b){"use strict";var C=y("../utils").log,S=y("../utils").browserDetails;b.exports=function(){var k=function(L){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[L.name]||L.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[L.message]||L.message,constraint:L.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},x=function(L,D,M){var w=function(_){if("object"!==typeof _||_.require)return _;var I=[];return Object.keys(_).forEach(function(O){if("require"!==O&&"advanced"!==O&&"mediaSource"!==O){var U=_[O]="object"===typeof _[O]?_[O]:{ideal:_[O]};if((void 0!==U.min||void 0!==U.max||void 0!==U.exact)&&I.push(O),void 0!==U.exact&&("number"===typeof U.exact?U.min=U.max=U.exact:_[O]=U.exact,delete U.exact),void 0!==U.ideal){_.advanced=_.advanced||[];var G={};G[O]="number"===typeof U.ideal?{min:U.ideal,max:U.ideal}:U.ideal,_.advanced.push(G),delete U.ideal,Object.keys(U).length||delete _[O]}}}),I.length&&(_.require=I),_};return L=JSON.parse(JSON.stringify(L)),38>S.version&&(C("spec: "+JSON.stringify(L)),L.audio&&(L.audio=w(L.audio)),L.video&&(L.video=w(L.video)),C("ff37: "+JSON.stringify(L))),navigator.mozGetUserMedia(L,D,function(_){M(k(_))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(L){return new Promise(function(D,M){x(L,D,M)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(L){L([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},41>S.version){var P=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return P().then(void 0,function(L){if("NotFoundError"===L.name)return[];throw L})}}if(49>S.version){var R=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(L){return R(L).then(function(D){if(L.audio&&!D.getAudioTracks().length||L.video&&!D.getVideoTracks().length)throw D.getTracks().forEach(function(M){M.stop()}),new DOMException("The object can not be found here.","NotFoundError");return D},function(D){return Promise.reject(k(D))})}}navigator.getUserMedia=function(L,D,M){return 44>S.version?x(L,D,M):void(console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(L).then(D,M))}}},{"../utils":11}],10:[function(y,b){"use strict";var C={shimAddStream:function(){"object"===typeof window&&window.RTCPeerConnection&&!("addStream"in window.RTCPeerConnection.prototype)&&(RTCPeerConnection.prototype.addStream=function(S){var k=this;S.getTracks().forEach(function(x){k.addTrack(x,S)})})},shimOnAddStream:function(){"object"===typeof window&&window.RTCPeerConnection&&!("onaddstream"in window.RTCPeerConnection.prototype)&&Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(S){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=S),this.addEventListener("track",this._onaddstreampoly=function(k){var x=k.streams[0];if(this._streams||(this._streams=[]),!(0<=this._streams.indexOf(x))){this._streams.push(x);var E=new Event("addstream");E.stream=k.streams[0],this.dispatchEvent(E)}}.bind(this))}})},shimCallbacksAPI:function(){if("object"===typeof window&&window.RTCPeerConnection){var S=RTCPeerConnection.prototype,k=S.createOffer,x=S.createAnswer,E=S.setLocalDescription,P=S.setRemoteDescription,R=S.addIceCandidate;S.createOffer=function(D,M){var w=2<=arguments.length?arguments[2]:arguments[0],_=k.apply(this,[w]);return M?(_.then(D,M),Promise.resolve()):_},S.createAnswer=function(D,M){var w=2<=arguments.length?arguments[2]:arguments[0],_=x.apply(this,[w]);return M?(_.then(D,M),Promise.resolve()):_};var L=function(D,M,w){var _=E.apply(this,[D]);return w?(_.then(M,w),Promise.resolve()):_};S.setLocalDescription=L,L=function(D,M,w){var _=P.apply(this,[D]);return w?(_.then(M,w),Promise.resolve()):_},S.setRemoteDescription=L,L=function(D,M,w){var _=R.apply(this,[D]);return w?(_.then(M,w),Promise.resolve()):_},S.addIceCandidate=L}},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(S,k,x){navigator.mediaDevices.getUserMedia(S).then(k,x)}.bind(navigator)))}};b.exports={shimCallbacksAPI:C.shimCallbacksAPI,shimAddStream:C.shimAddStream,shimOnAddStream:C.shimOnAddStream,shimGetUserMedia:C.shimGetUserMedia}},{}],11:[function(y,b){"use strict";var C=!0,S={disableLog:function(k){return"boolean"===typeof k?(C=k,k?"adapter.js logging disabled":"adapter.js logging enabled"):new Error("Argument type: "+typeof k+". Please use a boolean.")},log:function(){if("object"===typeof window){if(C)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(k,x,E){var P=k.match(x);return P&&P.length>=E&&parseInt(P[E],10)},detectBrowser:function(){var k={browser:null,version:null};if("undefined"===typeof window||!window.navigator)return k.browser="Not a browser.",k;if(navigator.mozGetUserMedia)k.browser="firefox",k.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia){if(window.webkitRTCPeerConnection)k.browser="chrome",k.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(navigator.userAgent.match(/Version\/(\d+).(\d+)/))k.browser="safari",k.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1);else return k.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",k;}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))k.browser="edge",k.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(navigator.mediaDevices&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./))k.browser="safari",k.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1);else return k.browser="Not a supported browser.",k;return k},shimCreateObjectURL:function(){if("object"===typeof window&&window.HTMLMediaElement&&"srcObject"in window.HTMLMediaElement.prototype){var k=URL.createObjectURL.bind(URL),x=URL.revokeObjectURL.bind(URL),E=new Map,P=0;URL.createObjectURL=function(D){if("getTracks"in D){var M="polyblob:"+ ++P;return E.set(M,D),console.log("URL.createObjectURL(stream) is deprecated! Use elem.srcObject = stream instead!"),M}return k(D)},URL.revokeObjectURL=function(D){x(D),E.delete(D)};var R=Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,"src");Object.defineProperty(window.HTMLMediaElement.prototype,"src",{get:function(){return R.get.apply(this)},set:function(D){return this.srcObject=E.get(D)||null,R.set.apply(this,[D])}});var L=HTMLMediaElement.prototype.setAttribute;HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=E.get(arguments[1])||null),L.apply(this,arguments)}}}};b.exports={log:S.log,disableLog:S.disableLog,browserDetails:S.detectBrowser(),extractVersion:S.extractVersion,shimCreateObjectURL:S.shimCreateObjectURL,detectBrowser:S.detectBrowser.bind(S)}},{}]},{},[2])(2)});